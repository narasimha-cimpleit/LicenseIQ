# Licence IQ Research Platform - System Architecture

## High-Level Architecture Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                    LICENCE IQ RESEARCH PLATFORM                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐    ┌─────────────┐    ┌────────────────┐     │
│  │   Frontend   │    │   Backend   │    │   AI Service   │     │
│  │   (React)    │◄──►│ (Express.js)│◄──►│   (Groq API)   │     │
│  │              │    │             │    │                │     │
│  └──────────────┘    └─────────────┘    └────────────────┘     │
│           │                   │                    │            │
│           │                   │                    │            │
│  ┌──────────────┐    ┌─────────────┐    ┌────────────────┐     │
│  │  UI Library  │    │  Database   │    │  File Storage  │     │
│  │ (shadcn/ui)  │    │(PostgreSQL) │    │   (Local FS)   │     │
│  └──────────────┘    └─────────────┘    └────────────────┘     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Detailed System Architecture

### 1. Frontend Architecture (Client Layer)
```
┌─────────────────────────────────────────────────────────────────┐
│                     FRONTEND ARCHITECTURE                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌─────────────┐│
│  │    Auth    │  │ Contracts  │  │ Analytics  │  │   Upload    ││
│  │   Pages    │  │   Pages    │  │   Pages    │  │    Page     ││
│  │            │  │            │  │            │  │             ││
│  └────────────┘  └────────────┘  └────────────┘  └─────────────┘│
│         │               │               │               │        │
│         └───────────────┼───────────────┼───────────────┘        │
│                         │               │                        │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                   SHARED COMPONENTS                       │ │
│  │                                                           │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────┐ │ │
│  │  │ Contract │ │   Main   │ │  User    │ │    Dialog    │ │ │
│  │  │  Cards   │ │  Layout  │ │ Sidebar  │ │ Components   │ │ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────────┘ │ │
│  └────────────────────────────────────────────────────────────┘ │
│                         │                                        │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                    CORE SERVICES                          │ │
│  │                                                           │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────┐ │ │
│  │  │ TanStack │ │   Auth   │ │  Theme   │ │    Routing   │ │ │
│  │  │  Query   │ │ Context  │ │ Context  │ │   (Wouter)   │ │ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────────┘ │ │
│  └────────────────────────────────────────────────────────────┘ │
│                         │                                        │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                  DESIGN SYSTEM                            │ │
│  │                                                           │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────┐ │ │
│  │  │Tailwind  │ │ shadcn/  │ │ Lucide   │ │  Dark/Light  │ │ │
│  │  │   CSS    │ │    ui    │ │  Icons   │ │    Themes    │ │ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────────┘ │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2. Backend Architecture (Server Layer)
```
┌─────────────────────────────────────────────────────────────────┐
│                     BACKEND ARCHITECTURE                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                      API ROUTES                            │ │
│  │                                                            │ │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────────┐│ │
│  │ │   Auth   │ │Contracts │ │Analytics │ │  User Mgmt      ││ │
│  │ │  Routes  │ │  Routes  │ │  Routes  │ │    Routes       ││ │
│  │ └──────────┘ └──────────┘ └──────────┘ └─────────────────┘│ │
│  └────────────────────────────────────────────────────────────┘ │
│                         │                                        │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                    MIDDLEWARE                              │ │
│  │                                                            │ │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────────┐│ │
│  │ │   Auth   │ │   CORS   │ │  Audit   │ │     Error       ││ │
│  │ │Middleware│ │Middleware│ │ Logging  │ │   Handling      ││ │
│  │ └──────────┘ └──────────┘ └──────────┘ └─────────────────┘│ │
│  └────────────────────────────────────────────────────────────┘ │
│                         │                                        │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                     SERVICES                               │ │
│  │                                                            │ │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────────┐│ │
│  │ │   Groq   │ │   File   │ │   PDF    │ │     Audit       ││ │
│  │ │ Service  │ │ Service  │ │ Service  │ │    Service      ││ │
│  │ └──────────┘ └──────────┘ └──────────┘ └─────────────────┘│ │
│  └────────────────────────────────────────────────────────────┘ │
│                         │                                        │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                  DATA ACCESS LAYER                         │ │
│  │                                                            │ │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────────┐│ │
│  │ │ Storage  │ │ Database │ │ Session  │ │   Connection    ││ │
│  │ │Interface │ │ Storage  │ │ Storage  │ │     Pool        ││ │
│  │ └──────────┘ └──────────┘ └──────────┘ └─────────────────┘│ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3. Data Flow Architecture
```
┌─────────────────────────────────────────────────────────────────┐
│                       DATA FLOW DIAGRAM                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ┌─────────┐    ┌─────────────┐    ┌─────────────────────────┐   │
│ │  User   │───►│   Upload    │───►│    File Processing      │   │
│ │Interface│    │  Component  │    │       Pipeline          │   │
│ └─────────┘    └─────────────┘    └─────────────────────────┘   │
│                       │                        │                │
│                       │                        ▼                │
│ ┌─────────────────────┼──────────┐  ┌─────────────────────────┐ │
│ │                     │          │  │    Text Extraction      │ │
│ │  ┌─────────────┐    │          │  │     (PDF/DOCX)          │ │
│ │  │   Session   │    │          │  └─────────────────────────┘ │
│ │  │ Management  │    │          │             │                │
│ │  └─────────────┘    │          │             ▼                │
│ │         │           │          │  ┌─────────────────────────┐ │
│ │  ┌─────────────┐    │          │  │    AI Analysis          │ │
│ │  │    Auth     │    │          │  │   (Groq LLaMA)         │ │
│ │  │ Validation  │    │          │  └─────────────────────────┘ │
│ │  └─────────────┘    │          │             │                │
│ │         │           │          │             ▼                │
│ │  ┌─────────────┐    │          │  ┌─────────────────────────┐ │
│ │  │    RBAC     │    │          │  │   Analysis Storage      │ │
│ │  │ Permission  │    │          │  │     (Database)          │ │
│ │  │   Check     │    │          │  └─────────────────────────┘ │
│ │  └─────────────┘    │          │             │                │
│ └─────────────────────┼──────────┘             │                │
│                       │                        │                │
│                       ▼                        ▼                │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │                   DATABASE LAYER                            │ │
│ │                                                             │ │
│ │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────────────┐│ │
│ │  │  Users  │  │Contract │  │Analysis │  │   Audit Logs    ││ │
│ │  │  Table  │  │  Table  │  │  Table  │  │     Table       ││ │
│ │  └─────────┘  └─────────┘  └─────────┘  └─────────────────┘│ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4. Security Architecture
```
┌─────────────────────────────────────────────────────────────────┐
│                     SECURITY ARCHITECTURE                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │                   AUTHENTICATION LAYER                     │ │
│ │                                                             │ │
│ │  ┌─────────┐    ┌──────────────┐    ┌──────────────────┐   │ │
│ │  │  Login  │───►│   Session    │───►│     Cookie       │   │ │
│ │  │Validation│    │  Management  │    │   (HttpOnly)     │   │ │
│ │  └─────────┘    └──────────────┘    └──────────────────┘   │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                │                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │                  AUTHORIZATION LAYER                       │ │
│ │                                                             │ │
│ │  ┌─────────────┐  ┌──────────────┐  ┌──────────────────┐   │ │
│ │  │    RBAC     │  │  Permission  │  │      Route       │   │ │
│ │  │   System    │  │   Matrix     │  │   Protection     │   │ │
│ │  │(5 Roles)    │  │              │  │                  │   │ │
│ │  └─────────────┘  └──────────────┘  └──────────────────┘   │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                │                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │                    INPUT VALIDATION                         │ │
│ │                                                             │ │
│ │  ┌─────────────┐  ┌──────────────┐  ┌──────────────────┐   │ │
│ │  │    Zod      │  │     File     │  │     Request      │   │ │
│ │  │ Validation  │  │  Validation  │  │   Sanitization   │   │ │
│ │  │             │  │              │  │                  │   │ │
│ │  └─────────────┘  └──────────────┘  └──────────────────┘   │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                │                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │                      DATA PROTECTION                        │ │
│ │                                                             │ │
│ │  ┌─────────────┐  ┌──────────────┐  ┌──────────────────┐   │ │
│ │  │ Encrypted   │  │  Parameterized │ │     Secure      │   │ │
│ │  │ Passwords   │  │    Queries     │ │   File Paths    │   │ │
│ │  │   (bcrypt)  │  │   (Drizzle)    │ │                 │   │ │
│ │  └─────────────┘  └──────────────┘  └──────────────────┘   │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 5. AI Processing Pipeline
```
┌─────────────────────────────────────────────────────────────────┐
│                   AI PROCESSING ARCHITECTURE                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────────┐    ┌─────────────────┐  │
│  │   File      │───►│   Text          │───►│    Groq API     │  │
│  │  Upload     │    │ Extraction      │    │   (LLaMA 3.1)   │  │
│  │             │    │                 │    │                 │  │
│  └─────────────┘    └─────────────────┘    └─────────────────┘  │
│         │                     │                       │         │
│         │                     │                       │         │
│  ┌─────────────┐    ┌─────────────────┐    ┌─────────────────┐  │
│  │ Validation  │    │   Processing    │    │   Analysis      │  │
│  │ & Storage   │    │     Queue       │    │   Results       │  │
│  │             │    │                 │    │                 │  │
│  └─────────────┘    └─────────────────┘    └─────────────────┘  │
│         │                     │                       │         │
│         │                     │                       │         │
│  ┌─────────────┐    ┌─────────────────┐    ┌─────────────────┐  │
│  │  Database   │    │    Status       │    │   Frontend      │  │
│  │  Storage    │    │   Updates       │    │    Display      │  │
│  │             │    │                 │    │                 │  │
│  └─────────────┘    └─────────────────┘    └─────────────────┘  │
│                                                                 │
│                     Processing States Flow:                     │
│                                                                 │
│  ┌─────────┐   ┌──────────────┐   ┌──────────┐   ┌──────────┐  │
│  │Pending  │──►│  Processing  │──►│Analyzed  │   │ Failed   │  │
│  │         │   │              │   │          │   │          │  │
│  └─────────┘   └──────────────┘   └──────────┘   └──────────┘  │
│                        │                              ▲        │
│                        │                              │        │
│                        └──────────────────────────────┘        │
│                           (Error Handling)                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Component Interaction Matrix

### Frontend Components
| Component | Dependencies | Purpose |
|-----------|-------------|---------|
| AuthPage | useAuth, Form components | User authentication |
| ContractAnalysis | TanStack Query, AI results | Display analysis results |
| ContractCard | Contract data, Status badges | Contract list item |
| Dashboard | Analytics API, Chart components | Overview metrics |
| Upload | File handling, Progress tracking | Document upload |

### Backend Services
| Service | Dependencies | Purpose |
|---------|-------------|---------|
| GroqService | Groq API, HTTP client | AI analysis processing |
| FileService | Multer, File system | File upload handling |
| Storage | Drizzle ORM, PostgreSQL | Database operations |
| AuthService | Session, Password hashing | Authentication logic |

### Database Relationships
| Table | Related To | Relationship Type |
|-------|-----------|------------------|
| users | contracts | One-to-many (uploadedBy) |
| contracts | contractAnalysis | One-to-one |
| users | auditLogs | One-to-many |
| contracts | auditLogs | One-to-many (via entityId) |

## Scalability Considerations

### Horizontal Scaling Points
1. **API Server:** Multiple Express.js instances behind load balancer
2. **Database:** PostgreSQL read replicas for query distribution
3. **File Storage:** Distributed object storage (S3, GCS)
4. **AI Processing:** Queue-based processing with worker nodes

### Performance Optimizations
1. **Database Indexing:** Optimized queries with proper indexes
2. **Connection Pooling:** Efficient database connection management
3. **Caching:** Redis for session and frequently accessed data
4. **CDN:** Static asset delivery optimization
5. **Compression:** Gzip compression for API responses